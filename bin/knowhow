#!/usr/bin/env python
#-*- coding: utf-8 -*-

"""Run a knowhow command.

Usage:
    knowhow [options] <command> [<args>...]


Options:
    -h, --help          Show this help info.
    -V, --version       Show version.

Commands:
    search          Search a knowhow repo
    add             Add a snippet to a knowhow repo
    remove          Remove a snippet from a knowhow repo
    info            Show info about a knowhow repo
    load            Load a dumped export into a knowhow repo from STDIN
    dump            Dump a knowhow repo to STDOUT
    tags            Show tags in knowhow repo
    help            Show more information about a specific command

Environment:
    KNOWHOW_HOME    Optional directory for knowhow conf and other storage
    KNOWHOW_CONF    Optional file path containing knowhow configuration
    KNOWHOW_DATA    Optional directory for knowhow index data
"""

from __future__ import absolute_import
from __future__ import print_function
from __future__ import unicode_literals
from __future__ import division

import sys
import os

from docopt import docopt

import knowhow


if __name__ == '__main__':
    args = docopt(__doc__, options_first=True, version=knowhow.__version__)
    knowhow_bin_dir = os.path.dirname(__file__)
    knowhow_bin = os.path.basename(__file__)
    python = sys.executable

    def help(bin):
        script = os.path.join(knowhow_bin_dir, bin)
        os.execl(python, python, script, '--help')

    cmds = ['search', 'add', 'remove', 'dump', 'pprint', 'load', 'info',
            'tags']

    if args['<command>'] in ['help', None]:
        bin = args['<args>'][0] if args['<args>'] else None
        if bin not in cmds:
            bin = 'knowhow'
        help(bin)
    else:
        script = os.path.join(knowhow_bin_dir, args['<command>'])
        if os.path.exists(script):
            cmd = [python, script] + args['<args>']
            os.execv(python, cmd)
        help('knowhow')

## sublimeconf: filetype=python
